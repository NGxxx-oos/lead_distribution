–ú–∏–Ω–∏-CRM –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–∏–¥–æ–≤ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
–ú–∏–Ω–∏-CRM —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π (–ª–∏–¥–æ–≤) –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ —Å —É—á—ë—Ç–æ–º:

–ò—Å—Ç–æ—á–Ω–∏–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è (—Ä–∞–∑–Ω—ã–µ –±–æ—Ç—ã/–∫–∞–Ω–∞–ª—ã)

–ù–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–∏–¥–æ–≤)

–í–µ—Å–æ–≤–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏

–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–∏–¥–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º

‚öñÔ∏è –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏

üõ°Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

üìà –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

üîß –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
text
lead_distribution/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py        # Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ crud.py           # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ services.py       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
Backend: Python 3.8+

–§—Ä–µ–π–º–≤–æ—Ä–∫: FastAPI

ORM: SQLAlchemy

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: SQLite (—Ñ–∞–π–ª–æ–≤–∞—è, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)

–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: Pydantic v2

–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π:
text
Lead (1) ‚îÄ‚îÄ‚îÄ‚îÄ (n) Contact (n) ‚îÄ‚îÄ‚îÄ‚îÄ (1) Source
                    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ (1) Operator
–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π:
1. Lead (–õ–∏–¥)
–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.

–ü–æ–ª—è:

id (Integer) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

email (String, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π) - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª–∏–¥–∞

phone (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Ç–µ–ª–µ—Ñ–æ–Ω

full_name (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∏–º—è

created_at (DateTime) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

Email –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

–û–¥–∏–Ω –ª–∏–¥ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –ª–∏–¥–∞

2. Operator (–û–ø–µ—Ä–∞—Ç–æ—Ä)
–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è.

–ü–æ–ª—è:

id (Integer) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

name (String) - –∏–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

is_active (Boolean) - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä (–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ –ª–∏–¥—ã)

max_leads (Integer) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–∏–¥–æ–≤

current_leads (Integer) - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–∏–¥–æ–≤

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

–ü—Ä–∏ is_active=false –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ –ª–∏–¥—ã

current_leads –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏/–∑–∞–∫—Ä—ã—Ç–∏–∏ –ª–∏–¥–æ–≤

–õ–∏–º–∏—Ç max_leads –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

3. Source (–ò—Å—Ç–æ—á–Ω–∏–∫)
–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–Ω–∞–ª –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –æ–±—Ä–∞—â–µ–Ω–∏–π (–±–æ—Ç, —Å–∞–π—Ç, —Å–æ—Ü—Å–µ—Ç—å).

–ü–æ–ª—è:

id (Integer) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

name (String) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

description (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –æ–ø–∏—Å–∞–Ω–∏–µ

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

–ö–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏

4. SourceOperator (–°–≤—è–∑—å –∏—Å—Ç–æ—á–Ω–∏–∫-–æ–ø–µ—Ä–∞—Ç–æ—Ä)
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∫–∞–∫–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∏ —Å –∫–∞–∫–∏–º–∏ –≤–µ—Å–∞–º–∏.

–ü–æ–ª—è:

id (Integer) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

source_id (Integer, FK) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫

operator_id (Integer, FK) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

weight (Integer) - –≤–µ—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–ü—Ä–∏–º–µ—Ä –≤–µ—Å–æ–≤:

–û–ø–µ—Ä–∞—Ç–æ—Ä –ê: –≤–µ—Å 30

–û–ø–µ—Ä–∞—Ç–æ—Ä –ë: –≤–µ—Å 10

–û–ø–µ—Ä–∞—Ç–æ—Ä –í: –≤–µ—Å 60

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: 30%, 10%, 60% —Ç—Ä–∞—Ñ–∏–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ

5. Contact (–û–±—Ä–∞—â–µ–Ω–∏–µ)
–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–∫—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –ª–∏–¥–∞ –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

–ü–æ–ª—è:

id (Integer) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

lead_id (Integer, FK) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–∏–¥–∞

source_id (Integer, FK) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫

operator_id (Integer, FK, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä

message (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Ç–µ–∫—Å—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è

status (String) - —Å—Ç–∞—Ç—É—Å (new, in_progress, closed)

created_at (DateTime) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω, operator_id –º–æ–∂–µ—Ç –±—ã—Ç—å NULL

–°—Ç–∞—Ç—É—Å—ã: new (–Ω–æ–≤—ã–π), in_progress (–≤ —Ä–∞–±–æ—Ç–µ), closed (–∑–∞–∫—Ä—ã—Ç)

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è:
–®–∞–≥ 1: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏–¥–∞
python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ –ª–æ–≥–∏–∫–∏
if lead —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ email:
    –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ª–∏–¥–∞
else:
    —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞
–ö—Ä–∏—Ç–µ—Ä–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: Email –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª–∏–¥–∞. –ï—Å–ª–∏ –ª–∏–¥ —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ, –≤—Å–µ –Ω–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –Ω–µ–º—É.

–®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
–û–ø–µ—Ä–∞—Ç–æ—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º –µ—Å–ª–∏:

–ê–∫—Ç–∏–≤–µ–Ω: is_active = True

–ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω: current_leads < max_leads

–ù–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫: –°—É—â–µ—Å—Ç–≤—É–µ—Ç –∑–∞–ø–∏—Å—å –≤ SourceOperator –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–∞—Ä—ã –∏—Å—Ç–æ—á–Ω–∏–∫-–æ–ø–µ—Ä–∞—Ç–æ—Ä —Å weight > 0

–®–∞–≥ 3: –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–æ–≤:

–§–æ—Ä–º—É–ª–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ i:

text
P(i) = weight_i / Œ£(weight_j) –¥–ª—è –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ j
–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞:

python
# 1. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É –≤–µ—Å–æ–≤
total_weight = sum(weights)

# 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
random_value = random.uniform(0, total_weight)

# 3. –í—ã–±—Ä–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
cumulative = 0
for operator, weight in zip(operators, weights):
    cumulative += weight
    if random_value <= cumulative:
        return operator
–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:

text
–û–ø–µ—Ä–∞—Ç–æ—Ä—ã: –ê(–≤–µ—Å=30), –ë(–≤–µ—Å=10), –í(–≤–µ—Å=60)
–°—É–º–º–∞ –≤–µ—Å–æ–≤: 100
–î–∏–∞–ø–∞–∑–æ–Ω—ã: –ê=[0-30), –ë=[30-40), –í=[40-100)
–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏: –ê=30%, –ë=10%, –í=60%
–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞:

–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç—á–∏–∫ current_leads –Ω–∞ 1

–ï—Å–ª–∏ current_leads >= max_leads, –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è

–®–∞–≥ 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
–°—Ü–µ–Ω–∞—Ä–∏–∏:

–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–í—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞

–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–†–µ—à–µ–Ω–∏–µ –≤ –¥–∞–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

–°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—Ä–∞—â–µ–Ω–∏–µ –±–µ–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (operator_id = NULL)

–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞—â–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ "new"

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –Ω–∞–∑–Ω–∞—á–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ–∑–∂–µ

API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
–ì—Ä—É–ø–ø–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
1. –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
Endpoint: POST /operators/

–û–ø–∏—Å–∞–Ω–∏–µ: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):

json
{
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "is_active": true,
  "max_leads": 15
}
–ü–æ–ª—è:

name (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –∏–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

is_active (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true) - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä

max_leads (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤

–û—Ç–≤–µ—Ç (201 Created):

json
{
  "id": 1,
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "is_active": true,
  "max_leads": 15,
  "current_leads": 0
}
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
Endpoint: GET /operators/

–û–ø–∏—Å–∞–Ω–∏–µ: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:

skip (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0) - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–µ N –∑–∞–ø–∏—Å–µ–π

limit (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100) - –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

–û—Ç–≤–µ—Ç:

json
[
  {
    "id": 1,
    "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "is_active": true,
    "max_leads": 15,
    "current_leads": 3
  },
  {
    "id": 2,
    "name": "–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞",
    "is_active": true,
    "max_leads": 20,
    "current_leads": 15
  }
]
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
Endpoint: PATCH /operators/{operator_id}

–û–ø–∏—Å–∞–Ω–∏–µ: –ß–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON, –≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã):

json
{
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (—Å—Ç–∞—Ä—à–∏–π)",
  "is_active": false,
  "max_leads": 20
}
–û—Ç–≤–µ—Ç:

json
{
  "id": 1,
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (—Å—Ç–∞—Ä—à–∏–π)",
  "is_active": false,
  "max_leads": 20,
  "current_leads": 3
}
–ì—Ä—É–ø–ø–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
1. –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
Endpoint: POST /sources/

–û–ø–∏—Å–∞–Ω–∏–µ: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π.

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

json
{
  "name": "Telegram –ë–æ—Ç",
  "description": "–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –≤ Telegram"
}
–û—Ç–≤–µ—Ç:

json
{
  "id": 1,
  "name": "Telegram –ë–æ—Ç",
  "description": "–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –≤ Telegram"
}
2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫
Endpoint: POST /sources/{source_id}/assign_operator

–û–ø–∏—Å–∞–Ω–∏–µ: –ù–∞–∑–Ω–∞—á–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º.

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

json
{
  "operator_id": 1,
  "weight": 30
}
–ü–æ–ª—è:

operator_id (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

weight (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1) - –≤–µ—Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–û—Ç–≤–µ—Ç:

json
{
  "message": "Operator assigned to source successfully"
}
–ì—Ä—É–ø–ø–∞: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—â–µ–Ω–∏–π
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
Endpoint: POST /leads/register_contact/

–û–ø–∏—Å–∞–Ω–∏–µ: –û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

–ù–∞—Ö–æ–¥–∏—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –ª–∏–¥–∞

–í—ã–±–∏—Ä–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –æ–±—Ä–∞—â–µ–Ω–∏—è

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

json
{
  "email": "client@example.com",
  "source_id": 1,
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ –≤–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö",
  "phone": "+79991234567",
  "full_name": "–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤"
}
–ü–æ–ª—è:

email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - email –ª–∏–¥–∞ (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)

source_id (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞

message (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Ç–µ–∫—Å—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è

phone (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Ç–µ–ª–µ—Ñ–æ–Ω

full_name (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∏–º—è

–û—Ç–≤–µ—Ç:

json
{
  "id": 1,
  "lead_id": 1,
  "source_id": 1,
  "operator_id": 2,
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ –≤–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö",
  "status": "new",
  "created_at": "2024-01-15T10:30:00Z",
  "email": "client@example.com",
  "phone": "+79991234567",
  "full_name": "–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤"
}
–ì—Ä—É–ø–ø–∞: –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
1. –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤
Endpoint: GET /leads/

–û–ø–∏—Å–∞–Ω–∏–µ: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–π.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

skip (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø—Ä–æ–ø—É—Å–∫ –∑–∞–ø–∏—Å–µ–π

limit (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞

–û—Ç–≤–µ—Ç:

json
[
  {
    "id": 1,
    "email": "client@example.com",
    "phone": "+79991234567",
    "full_name": "–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤",
    "created_at": "2024-01-15T10:30:00Z",
    "contacts_count": 3
  }
]
2. –û–±—Ä–∞—â–µ–Ω–∏—è –ª–∏–¥–∞
Endpoint: GET /leads/{lead_id}/contacts

–û–ø–∏—Å–∞–Ω–∏–µ: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–∏–¥–∞.

–û—Ç–≤–µ—Ç:

json
[
  {
    "id": 1,
    "lead_id": 1,
    "source_id": 1,
    "operator_id": 2,
    "message": "–ü–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ",
    "status": "closed",
    "created_at": "2024-01-10T10:30:00Z"
  },
  {
    "id": 3,
    "lead_id": 1,
    "source_id": 2,
    "operator_id": 1,
    "message": "–í—Ç–æ—Ä–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ",
    "status": "in_progress",
    "created_at": "2024-01-15T11:30:00Z"
  }
]
–ì—Ä—É–ø–ø–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–∞—à–±–æ—Ä–¥
1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
Endpoint: GET /dashboard/operator_stats

–û–ø–∏—Å–∞–Ω–∏–µ: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º.

–û—Ç–≤–µ—Ç:

json
[
  {
    "operator_id": 1,
    "operator_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "is_active": true,
    "max_leads": 15,
    "current_leads": 10,
    "available_capacity": 5,
    "total_contacts": 45
  }
]
2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
Endpoint: GET /dashboard/source_stats

–û–ø–∏—Å–∞–Ω–∏–µ: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º.

–û—Ç–≤–µ—Ç:

json
[
  {
    "source_id": 1,
    "source_name": "Telegram –ë–æ—Ç",
    "total_contacts": 120,
    "operators": [
      {
        "operator_id": 1,
        "operator_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
        "weight": 30,
        "contacts_assigned": 36
      },
      {
        "operator_id": 2,
        "operator_name": "–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞",
        "weight": 70,
        "contacts_assigned": 84
      }
    ]
  }
]
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
Python 3.8 –∏–ª–∏ –≤—ã—à–µ

pip (–º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ Python)

–®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
mkdir lead_distribution
cd lead_distribution

# 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python -m venv venv

# 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
# –ù–∞ Windows:
venv\Scripts\activate
# –ù–∞ Linux/Mac:
source venv/bin/activate
–®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
pip install fastapi==0.104.1
pip install sqlalchemy==2.0.23
pip install pydantic==2.5.0
pip install uvicorn[standard]==0.24.0

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª requirements.txt
pip install -r requirements.txt
–®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
bash
# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
uvicorn app.main:app --reload

# –ó–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
uvicorn app.main:app --host 0.0.0.0 --port 8000
–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000/docs

–í—ã —É–≤–∏–¥–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger UI

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞

–®–∞–≥ 5: –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã
bash
# –ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã:

# 1. –°–æ–∑–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
curl -X POST "http://localhost:8000/operators/" \
  -H "Content-Type: application/json" \
  -d '{"name": "–û–ø–µ—Ä–∞—Ç–æ—Ä 1", "max_leads": 10}'

curl -X POST "http://localhost:8000/operators/" \
  -H "Content-Type: application/json" \
  -d '{"name": "–û–ø–µ—Ä–∞—Ç–æ—Ä 2", "max_leads": 15}'

# 2. –°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫
curl -X POST "http://localhost:8000/sources/" \
  -H "Content-Type: application/json" \
  -d '{"name": "–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç", "description": "Telegram"}'

# 3. –ù–∞–∑–Ω–∞—á–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫
curl -X POST "http://localhost:8000/sources/1/assign_operator" \
  -H "Content-Type: application/json" \
  -d '{"operator_id": 1, "weight": 30}'

curl -X POST "http://localhost:8000/sources/1/assign_operator" \
  -H "Content-Type: application/json" \
  -d '{"operator_id": 2, "weight": 70}'
–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã
bash
# –°–æ–∑–¥–∞–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
POST /operators/
{"name": "–ê–Ω–Ω–∞", "max_leads": 5}
{"name": "–ë–æ—Ä–∏—Å", "max_leads": 8}

# –°–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
POST /sources/
{"name": "WhatsApp –ë–æ—Ç"}

# –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å –≤–µ—Å–∞–º–∏
POST /sources/1/assign_operator
{"operator_id": 1, "weight": 40}  # –ê–Ω–Ω–∞: 40%
POST /sources/1/assign_operator  
{"operator_id": 2, "weight": 60}  # –ë–æ—Ä–∏—Å: 60%
2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—â–µ–Ω–∏–π
bash
# –ü–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ª–∏–¥)
POST /leads/register_contact/
{
  "email": "client1@test.com",
  "source_id": 1,
  "message": "–ü—Ä–∏–≤–µ—Ç!",
  "full_name": "–ö–ª–∏–µ–Ω—Ç 1"
}
# –û—Ç–≤–µ—Ç: –Ω–∞–∑–Ω–∞—á–µ–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä –ë–æ—Ä–∏—Å (60% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)

# –í—Ç–æ—Ä–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ —Ç–æ–≥–æ –∂–µ –ª–∏–¥–∞
POST /leads/register_contact/
{
  "email": "client1@test.com",  # –¢–æ—Ç –∂–µ email - —Ç–æ—Ç –∂–µ –ª–∏–¥
  "source_id": 1,
  "message": "–ï—â–µ –≤–æ–ø—Ä–æ—Å"
}
# –û—Ç–≤–µ—Ç: –Ω–∞–∑–Ω–∞—á–µ–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä –ê–Ω–Ω–∞ (40% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)

# –¢—Ä–µ—Ç—å–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞
POST /leads/register_contact/
{
  "email": "client2@test.com",
  "source_id": 1,
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ"
}
3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
GET /dashboard/operator_stats

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤  
GET /dashboard/source_stats

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ—Ö –ª–∏–¥–æ–≤
GET /leads/

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–∏–¥–∞
GET /leads/1/contacts
–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
–°–∏—Ç—É–∞—Ü–∏—è:
–ê–Ω–Ω–∞: max_leads = 3, current_leads = 3 (–¥–æ—Å—Ç–∏–≥–ª–∞ –ª–∏–º–∏—Ç–∞)

–ë–æ—Ä–∏—Å: max_leads = 5, current_leads = 1

–í–µ—Å–∞: –ê–Ω–Ω–∞(40), –ë–æ—Ä–∏—Å(60)

–ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:
bash
POST /leads/register_contact/
{
  "email": "new@test.com",
  "source_id": 1
}
–õ–æ–≥–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
–ê–Ω–Ω–∞ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (–¥–æ—Å—Ç–∏–≥–ª–∞ –ª–∏–º–∏—Ç–∞)

–û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ë–æ—Ä–∏—Å —Å –≤–µ—Å–æ–º 60

–ë–æ—Ä–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–µ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 100%

current_leads –ë–æ—Ä–∏—Å–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 2

–°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
–°–∏—Ç—É–∞—Ü–∏—è:
–í—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞

–ò–ª–∏ –≤—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã

–ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:
bash
POST /leads/register_contact/
{
  "email": "urgent@test.com",
  "source_id": 1
}
–†–µ–∑—É–ª—å—Ç–∞—Ç:
json
{
  "id": 15,
  "lead_id": 5,
  "source_id": 1,
  "operator_id": null,  // –û–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω!
  "message": null,
  "status": "new",
  "created_at": "2024-01-15T12:00:00Z",
  "email": "urgent@test.com",
  "phone": null,
  "full_name": null
}
–î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

–í—Ä—É—á–Ω—É—é –Ω–∞–∑–Ω–∞—á–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

–ò–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–¢–∏–ø: SQLite (—Ñ–∞–π–ª–æ–≤–∞—è)
–§–∞–π–ª: lead_distribution.db (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
–ú–∏–≥—Ä–∞—Ü–∏–∏: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
–§–∞–π–ª: app/services.py
–ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: select_operator_for_source()

python
def select_operator_for_source(db: Session, source_id: int) -> Optional[int]:
    # 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞
    source_operators = db.query(models.SourceOperator).filter(
        models.SourceOperator.source_id == source_id
    ).all()
    
    # 2. –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ª–∏–º–∏—Ç–∞–º
    available_operators = []
    weights = []
    
    for so in source_operators:
        operator = so.operator
        if operator.is_active and operator.current_leads < operator.max_leads:
            available_operators.append(operator)
            weights.append(so.weight)
    
    # 3. –í–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä
    if available_operators:
        total_weight = sum(weights)
        if total_weight == 0:
            weights = [1] * len(weights)
            total_weight = len(weights)
        
        rand = random.uniform(0, total_weight)
        cumulative = 0
        
        for i, weight in enumerate(weights):
            cumulative += weight
            if rand <= cumulative:
                return available_operators[i].id
    
    return None  # –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞:
–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ (source_id):

–û—Ç–≤–µ—Ç: 404 Not Found

–°–æ–æ–±—â–µ–Ω–∏–µ: "Source not found"

–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä (operator_id):

–û—Ç–≤–µ—Ç: 404 Not Found

–°–æ–æ–±—â–µ–Ω–∏–µ: "Operator not found"

–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–∞–ª–∏–¥–∞—Ü–∏—è Pydantic):

–û—Ç–≤–µ—Ç: 422 Unprocessable Entity

–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–î—É–±–ª–∏–∫–∞—Ç email (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–∏–¥–∞):

–ù–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–∏–¥

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–û–±—Ä–∞—â–µ–Ω–∏—è –±–µ–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
–ù–∞–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: current_leads / max_leads

–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ vs —Ü–µ–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö: –æ–±—Ä–∞—â–µ–Ω–∏—è –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ / –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ª–∏–¥–æ–≤: VIP –∫–ª–∏–µ–Ω—Ç—ã, —Å—Ä–æ—á–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è

–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º –æ–±—Ä–∞—â–µ–Ω–∏–π

–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: —É—á–µ—Ç —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω –∏ —á–∞—Å–æ–≤

–ö–∞—Å–∫–∞–¥–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏—Ö

–û—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è: –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏–π –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ

–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL/MySQL

–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: Redis –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å: async/await –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, –ª–∏–¥–æ–≤, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
